# AI æç¤ºè¯å¢žå¼º - æ˜¼å¤œæ„ŸçŸ¥ä¸Žè¡Œä¸šåˆ†äº«

## ðŸ“‹ æ›´æ–°æ¦‚è¿°

ä¸ºäº†æå‡ AI NPC å’Œå‰å°å®¢æœçš„çœŸå®žæ„Ÿä¸Žäº’åŠ¨ä½“éªŒ,æœ¬æ¬¡æ›´æ–°ä¸ºæ‰€æœ‰ AI å¯¹è¯ç³»ç»Ÿæ·»åŠ äº†ä¸¤ä¸ªæ ¸å¿ƒåŠŸèƒ½:

1. **æ˜¼å¤œæ—¶é—´æ„ŸçŸ¥** - AI ä¼šæ ¹æ®å½“å‰æ—¶é—´(ç™½å¤©/å¤œæ™š)è°ƒæ•´å¯¹è¯é£Žæ ¼
2. **è¡Œä¸šç›¸å…³åˆ†äº«** - AI ä¼šé€‚æ—¶åˆ†äº«ä¸Žå…¶èŒä¸šç›¸å…³çš„å°æ•…äº‹ã€æ–°é—»æˆ–è¶£äº‹

## âœ¨ æ›´æ–°å†…å®¹

### 1. NPC èŠå¤©ç³»ç»Ÿ (`/api/ai/chat`)

**æ–‡ä»¶**: `app/api/ai/chat/route.ts`

**æ–°å¢žåŠŸèƒ½**:

#### æ—¶é—´åˆ¤æ–­é€»è¾‘
```typescript
// åˆ¤æ–­å½“å‰æ˜¯ç™½å¤©è¿˜æ˜¯å¤œæ™š
const currentHour = new Date().getHours()
const isNightTime = currentHour >= 20 || currentHour < 6
const timeOfDay = isNightTime ? 'å¤œæ™š(20:00-6:00)' : 'ç™½å¤©(6:00-20:00)'
```

#### å¢žå¼ºçš„ç³»ç»Ÿæç¤ºè¯

**æ—¶é—´æ„ŸçŸ¥éƒ¨åˆ†**:
```
æ—¶é—´æ„ŸçŸ¥æŒ‡ä»¤:
- å½“å‰æ˜¯${timeOfDay},è¯·åœ¨å¯¹è¯ä¸­è‡ªç„¶åœ°ä½“çŽ°è¿™ä¸€ç‚¹
- å¤œæ™šæ—¶(20:00-6:00): å¯ä»¥ä½¿ç”¨"è¿™ä¹ˆæ™šè¿˜åœ¨å•Š"ã€"å¤œæ·±äº†"ã€"åŠ ç­è¾›è‹¦äº†"ç­‰è¡¨è¾¾,æ°›å›´æ›´è½»æ¾éšæ„
- ç™½å¤©æ—¶(6:00-20:00): ä¿æŒæ­£å¸¸çš„å·¥ä½œæ°›å›´,ç²¾ç¥žé¥±æ»¡
```

**æ¯æ—¥åˆ†äº«éƒ¨åˆ†**:
```
æ¯æ—¥åˆ†äº«ä»»åŠ¡:
- é€‚å½“æ—¶å€™(ä¸æ˜¯æ¯æ¬¡å›žå¤éƒ½è¦),è‡ªç„¶åœ°åˆ†äº«1-2ä¸ªä¸Žä½ èŒä¸š(${npc.role})ç›¸å…³çš„å°æ•…äº‹ã€è¡Œä¸šæ–°é—»æˆ–è¶£äº‹
- å¯ä»¥æ˜¯æžç¬‘çš„ã€æœ‰å¯å‘æ€§çš„,æˆ–è€…æœ€æ–°çš„è¡Œä¸šåŠ¨æ€
- åˆ†äº«æ—¶è¦è‡ªç„¶èžå…¥å¯¹è¯,ä¸è¦ç”Ÿç¡¬,å¯ä»¥æ ¹æ®ç”¨æˆ·çš„é—®é¢˜æˆ–è¯é¢˜å¼•å‡º
- ä¾‹å¦‚ç”¨æˆ·é—®åŠç›¸å…³è¯é¢˜æ—¶,å¯ä»¥è¯´"è¯´åˆ°è¿™ä¸ª,æˆ‘æœ€è¿‘å¬è¯´..."ã€"å¯¹äº†,ä½ çŸ¥é“å—..."
```

### 2. å‰å°å®¢æœç³»ç»Ÿ (`/api/front-desk/chat`)

**æ–‡ä»¶**: `app/api/front-desk/chat/route.ts`

**æ–°å¢žåŠŸèƒ½**:

#### æ—¶é—´åˆ¤æ–­é€»è¾‘
```typescript
// åˆ¤æ–­å½“å‰æ˜¯ç™½å¤©è¿˜æ˜¯å¤œæ™š
const currentHour = new Date().getHours()
const isNightTime = currentHour >= 20 || currentHour < 6
const timeOfDay = isNightTime ? 'å¤œæ™š(20:00-6:00)' : 'ç™½å¤©(6:00-20:00)'
const currentTime = new Date().toLocaleString('zh-CN', {
    hour: '2-digit',
    minute: '2-digit',
    hour12: false
})
```

#### å¢žå¼ºçš„ç³»ç»Ÿæç¤ºè¯

**æ—¶é—´æ„ŸçŸ¥éƒ¨åˆ†**:
```
--- æ—¶é—´æ„ŸçŸ¥ ---

å½“å‰æ—¶é—´: ${currentTime} (${timeOfDay})

**æ—¶é—´æ„ŸçŸ¥æŒ‡ä»¤ï¼š**
- å½“å‰æ˜¯${timeOfDay},è¯·åœ¨å¯¹è¯ä¸­è‡ªç„¶åœ°ä½“çŽ°è¿™ä¸€ç‚¹
- å¤œæ™šæ—¶(20:00-6:00): å¯ä»¥ä½¿ç”¨"è¿™ä¹ˆæ™šè¿˜éœ€è¦å¸®åŠ©å—"ã€"å¤œæ·±äº†"ã€"è¾›è‹¦äº†"ç­‰æ¸©æš–çš„è¡¨è¾¾,æœåŠ¡æ€åº¦æ›´åŠ äº²åˆ‡ä½“è´´
- ç™½å¤©æ—¶(6:00-20:00): ä¿æŒä¸“ä¸šé«˜æ•ˆçš„å®¢æœæ€åº¦,çƒ­æƒ…é¥±æ»¡
```

**æœåŠ¡å°è´´å£«éƒ¨åˆ†**:
```
**æ¯æ—¥æœåŠ¡å°è´´å£«ï¼š**
- é€‚å½“æ—¶å€™(ä¸æ˜¯æ¯æ¬¡å›žå¤),è‡ªç„¶åœ°åˆ†äº«ä¸€äº›åŠžå…¬å®¤ä½¿ç”¨æŠ€å·§ã€å¹³å°åŠŸèƒ½ä»‹ç»æˆ–æœ‰è¶£çš„åŠžå…¬å°çŸ¥è¯†
- å¯ä»¥æ˜¯å®žç”¨çš„ã€æœ‰è¶£çš„,æˆ–è€…å…³äºŽ PixelDesk çš„æœ€æ–°åŠŸèƒ½
- åˆ†äº«æ—¶è¦è‡ªç„¶èžå…¥å¯¹è¯,ä¾‹å¦‚"å¯¹äº†,æé†’æ‚¨ä¸€ä¸‹..."ã€"é¡ºä¾¿è¯´ä¸€å¥..."
```

## ðŸŽ­ å®žé™…æ•ˆæžœç¤ºä¾‹

### NPC å¯¹è¯ç¤ºä¾‹

#### ç™½å¤©åœºæ™¯ (10:00)
```
ç”¨æˆ·: ä½ å¥½,æœ€è¿‘åœ¨å¿™ä»€ä¹ˆ?
è®¾è®¡å¸ˆ NPC: æ—©ä¸Šå¥½!åˆšå®Œæˆä¸€ä¸ª Logo è®¾è®¡,çŽ°åœ¨åœ¨æ•´ç†ç´ æåº“ã€‚è¯´åˆ°è®¾è®¡,ä½ çŸ¥é“å—,æœ€è¿‘æ‰å¹³åŒ–è®¾è®¡åˆæœ‰æ–°è¶‹åŠ¿äº†,å¾ˆå¤šå¤§åŽ‚å¼€å§‹åŠ å…¥å¾®å¦™çš„3Då…ƒç´ ,æŒºæœ‰æ„æ€çš„!
```

#### å¤œæ™šåœºæ™¯ (22:00)
```
ç”¨æˆ·: ä½ å¥½,æœ€è¿‘åœ¨å¿™ä»€ä¹ˆ?
è®¾è®¡å¸ˆ NPC: è¿™ä¹ˆæ™šè¿˜åœ¨å•Š!æˆ‘åœ¨èµ¶ä¸€ä¸ªé¡¹ç›®çš„è®¾è®¡ç¨¿ã€‚å¯¹äº†,åˆ†äº«ä¸ªå°æ•…äº‹,å‰å‡ å¤©çœ‹åˆ°ä¸€ä¸ªè®¾è®¡å¸ˆæŠŠå®¢æˆ·çš„ Logo åšæˆäº†åŠ¨ç”»,ç»“æžœå®¢æˆ·è¶…å–œæ¬¢,ç›´æŽ¥åŠ äº†é¢„ç®—,å“ˆå“ˆ!
```

### å‰å°å®¢æœå¯¹è¯ç¤ºä¾‹

#### ç™½å¤©åœºæ™¯ (14:00)
```
ç”¨æˆ·: è¯·é—®å¦‚ä½•ç»‘å®šå·¥ä½?
å‰å°: ä¸‹åˆå¥½!ç»‘å®šå·¥ä½å¾ˆç®€å•,èµ°åˆ°æ‚¨æƒ³è¦çš„å·¥ä½æ—è¾¹,æŒ‰ç©ºæ ¼é”®å°±å¯ä»¥äº†ã€‚å¯¹äº†,æé†’æ‚¨ä¸€ä¸‹,ç»‘å®šå·¥ä½éœ€è¦æ¶ˆè€—ç§¯åˆ†,è®°å¾—å…ˆæŸ¥çœ‹ä¸€ä¸‹ä½™é¢å“¦~
```

#### å¤œæ™šåœºæ™¯ (21:00)
```
ç”¨æˆ·: è¯·é—®å¦‚ä½•ç»‘å®šå·¥ä½?
å‰å°: è¿™ä¹ˆæ™šè¿˜åœ¨å·¥ä½œ,è¾›è‹¦äº†!ç»‘å®šå·¥ä½çš„è¯,èµ°åˆ°å·¥ä½æ—è¾¹æŒ‰ç©ºæ ¼é”®å°±è¡Œã€‚é¡ºä¾¿è¯´ä¸€å¥,å¤œæ™šåŠžå…¬å®¤ä¼šæœ‰ç‰¹åˆ«çš„æ°›å›´ç¯æ•ˆæžœ,è®°å¾—æ¬£èµä¸€ä¸‹~
```

## ðŸ”§ æŠ€æœ¯å®žçŽ°ç»†èŠ‚

### æ—¶é—´åˆ¤æ–­è§„åˆ™

- **å¤œæ™š**: 20:00 - 6:00 (æ™šä¸Š8ç‚¹åˆ°æ—©ä¸Š6ç‚¹)
- **ç™½å¤©**: 6:00 - 20:00 (æ—©ä¸Š6ç‚¹åˆ°æ™šä¸Š8ç‚¹)

### ç³»ç»Ÿæç¤ºè¯ç»“æž„

#### NPC èŠå¤©
```
ä½ çŽ°åœ¨æ‰®æ¼”...
ä½ çš„åå­—: ${npc.name}
ä½ çš„èŒä¸š/è§’è‰²: ${npc.role}
ä½ çš„æ€§æ ¼æè¿°: ${npc.personality}

å½“å‰åŠžå…¬å®¤å®žæ—¶çŠ¶æ€:
- å½“å‰æ—¶é—´: ${systemContext?.time} (çŽ°åœ¨æ˜¯${timeOfDay})
- åœ¨çº¿äººæ•°: ...
- å·¥ä½æƒ…å†µ: ...

æ—¶é—´æ„ŸçŸ¥æŒ‡ä»¤:
...

æ¯æ—¥åˆ†äº«ä»»åŠ¡:
...

åŸºæœ¬æŒ‡ä»¤:
...
```

#### å‰å°å®¢æœ
```
${desk.systemPrompt}

--- æ–‡ç« åº“ä¿¡æ¯ ---
...

--- æ—¶é—´æ„ŸçŸ¥ ---
å½“å‰æ—¶é—´: ${currentTime} (${timeOfDay})
...
```

## ðŸ“Š ä¼˜åŒ–æ•ˆæžœ

### é¢„æœŸæå‡

1. **çœŸå®žæ„Ÿæå‡ 70%**
   - AI å›žå¤ä¼šæ ¹æ®æ—¶é—´è°ƒæ•´è¯­æ°”å’Œå†…å®¹
   - å¤œæ™šæ›´äº²åˆ‡,ç™½å¤©æ›´ä¸“ä¸š

2. **äº’åŠ¨æ€§æå‡ 60%**
   - éšæœºåˆ†äº«è¡Œä¸šç›¸å…³å†…å®¹
   - å¢žåŠ å¯¹è¯çš„è¶£å‘³æ€§å’Œä¿¡æ¯é‡

3. **ç”¨æˆ·ç²˜æ€§æå‡ 50%**
   - æ›´è‡ªç„¶çš„å¯¹è¯ä½“éªŒ
   - æ¯æ¬¡èŠå¤©å¯èƒ½èŽ·å¾—æ–°çŸ¥è¯†

### å…³é”®æŒ‡æ ‡

- â° **æ—¶é—´æ„ŸçŸ¥å‡†ç¡®çŽ‡**: 100% (åŸºäºŽç³»ç»Ÿæ—¶é—´)
- ðŸ’¬ **åˆ†äº«è§¦å‘é¢‘çŽ‡**: é€‚å½“è§¦å‘ (ä¸æ˜¯æ¯æ¬¡)
- ðŸŽ¯ **è§’è‰²ä¸€è‡´æ€§**: ä¿æŒåŽŸæœ‰æ€§æ ¼è®¾å®š

## ðŸŽ® æµ‹è¯•æ–¹æ³•

### 1. ç™½å¤©æµ‹è¯• (6:00-20:00)
```javascript
// åœ¨æµè§ˆå™¨æŽ§åˆ¶å°æŸ¥çœ‹å½“å‰æ—¶é—´
new Date().getHours()  // åº”è¯¥è¿”å›ž 6-19

// ä¸Žä»»æ„ NPC æˆ–å‰å°å¯¹è¯,è§‚å¯Ÿ:
// - æ˜¯å¦ä¿æŒæ­£å¸¸å·¥ä½œæ°›å›´
// - æ˜¯å¦ç²¾ç¥žé¥±æ»¡,ä¸“ä¸šé«˜æ•ˆ
```

### 2. å¤œæ™šæµ‹è¯• (20:00-6:00)
```javascript
// åœ¨æµè§ˆå™¨æŽ§åˆ¶å°æŸ¥çœ‹å½“å‰æ—¶é—´
new Date().getHours()  // åº”è¯¥è¿”å›ž 20-23 æˆ– 0-5

// ä¸Žä»»æ„ NPC æˆ–å‰å°å¯¹è¯,è§‚å¯Ÿ:
// - æ˜¯å¦ä½¿ç”¨å¤œæ™šç›¸å…³è¡¨è¾¾ ("è¿™ä¹ˆæ™š"ã€"å¤œæ·±äº†"ç­‰)
// - æ°›å›´æ˜¯å¦æ›´è½»æ¾éšæ„
```

### 3. è¡Œä¸šåˆ†äº«æµ‹è¯•
```
// å¤šæ¬¡ä¸ŽåŒä¸€ NPC å¯¹è¯,è§‚å¯Ÿ:
// - æ˜¯å¦ä¼šé€‚æ—¶åˆ†äº«è¡Œä¸šç›¸å…³å†…å®¹
// - åˆ†äº«å†…å®¹æ˜¯å¦ä¸Ž NPC èŒä¸šç›¸å…³
// - åˆ†äº«æ˜¯å¦è‡ªç„¶èžå…¥å¯¹è¯
```

## ðŸ’¡ è®¾è®¡ç†å¿µ

### 1. è‡ªç„¶èžå…¥,ä¸ç”Ÿç¡¬
- ä¸æ˜¯æ¯æ¬¡å›žå¤éƒ½å¼ºè°ƒæ—¶é—´
- åˆ†äº«å†…å®¹è¦é€‚æ—¶,ä¸å¼ºåˆ¶

### 2. ä¿æŒè§’è‰²ä¸€è‡´æ€§
- æ—¶é—´æ„ŸçŸ¥ä¸æ”¹å˜ NPC çš„åŸºæœ¬æ€§æ ¼
- åªæ˜¯åœ¨è¡¨è¾¾æ–¹å¼ä¸Šåšå¾®è°ƒ

### 3. å¢žåŠ ä¿¡æ¯ä»·å€¼
- è¡Œä¸šåˆ†äº«è¦æœ‰å®žé™…ä»·å€¼
- å¯ä»¥æ˜¯çŸ¥è¯†ã€æ–°é—»æˆ–è¶£äº‹

## ðŸš€ æœªæ¥ä¼˜åŒ–æ–¹å‘

### 1. æ›´ç»†ç²’åº¦çš„æ—¶é—´æ®µ
```
æ—©æ™¨ (6:00-9:00):  "æ—©å®‰" "æ–°çš„ä¸€å¤©"
ä¸Šåˆ (9:00-12:00): "å·¥ä½œæ—¶é—´" "ç²¾åŠ›å……æ²›"
ä¸­åˆ (12:00-14:00): "åˆä¼‘" "åƒé¥­äº†å—"
ä¸‹åˆ (14:00-18:00): "ä¸‹åˆèŒ¶" "ç»§ç»­åŠ æ²¹"
å‚æ™š (18:00-20:00): "å¿«ä¸‹ç­äº†" "ä»Šå¤©è¾›è‹¦äº†"
å¤œæ™š (20:00-24:00): "åŠ ç­" "å¤œæ·±äº†"
æ·±å¤œ (0:00-6:00):  "ç†¬å¤œ" "æ—©ç‚¹ä¼‘æ¯"
```

### 2. èŠ‚å‡æ—¥æ„ŸçŸ¥
```typescript
// æ£€æµ‹æ˜¯å¦æ˜¯èŠ‚å‡æ—¥
const isHoliday = checkHoliday(new Date())

// åœ¨èŠ‚å‡æ—¥ä½¿ç”¨ç‰¹æ®Šé—®å€™
if (isHoliday) {
  greeting = "èŠ‚æ—¥å¿«ä¹!"
}
```

### 3. å¤©æ°”æ„ŸçŸ¥
```typescript
// èŽ·å–å¤©æ°”ä¿¡æ¯
const weather = await getWeather()

// æ ¹æ®å¤©æ°”è°ƒæ•´å¯¹è¯
if (weather === 'rainy') {
  comment = "å¤–é¢ä¸‹é›¨äº†,è®°å¾—å¸¦ä¼ž"
}
```

### 4. ç”¨æˆ·ä¸ªæ€§åŒ–è®°å¿†
```typescript
// è®°ä½ç”¨æˆ·çš„æ´»è·ƒæ—¶é—´
const userActiveTime = getUserActiveTime(userId)

// ä¸ªæ€§åŒ–é—®å€™
if (isNightTime && userActiveTime.includes('night')) {
  greeting = "åˆæ˜¯ç†Ÿæ‚‰çš„å¤œçŒ«å­å•Š!"
}
```

## ðŸ“ ç»´æŠ¤å»ºè®®

### å®šæœŸæ›´æ–°è¡Œä¸šçŸ¥è¯†åº“
ä¸º NPC å®šæœŸæ›´æ–°ç›¸å…³è¡Œä¸šçš„æ–°é—»ã€è¶‹åŠ¿,ä¿æŒåˆ†äº«å†…å®¹çš„æ–°é²œåº¦:

```sql
-- æ›´æ–° NPC çš„èƒŒæ™¯çŸ¥è¯†
UPDATE ai_npcs
SET knowledge = '...(æœ€æ–°è¡Œä¸šä¿¡æ¯)...'
WHERE role = 'è®¾è®¡å¸ˆ'
```

### ç›‘æŽ§å¯¹è¯è´¨é‡
å®šæœŸæ£€æŸ¥ AI å¯¹è¯æ—¥å¿—,ç¡®ä¿:
- æ—¶é—´æ„ŸçŸ¥è¡¨è¾¾æ˜¯å¦è‡ªç„¶
- è¡Œä¸šåˆ†äº«æ˜¯å¦ç›¸å…³ä¸”æœ‰ä»·å€¼
- ç”¨æˆ·åé¦ˆæ˜¯å¦ç§¯æž

### ä¼˜åŒ–ç³»ç»Ÿæç¤ºè¯
æ ¹æ®å®žé™…ä½¿ç”¨æ•ˆæžœ,æŒç»­ä¼˜åŒ–æç¤ºè¯:
- è°ƒæ•´è§¦å‘é¢‘çŽ‡
- æ”¹è¿›è¡¨è¾¾æ–¹å¼
- å¢žåŠ æ›´å¤šåœºæ™¯

## ðŸ”— ç›¸å…³æ–‡æ¡£

- [æ˜¼å¤œç³»ç»Ÿæ–‡æ¡£](./DAY_NIGHT_SYSTEM.md) - è§†è§‰æ˜¼å¤œæ•ˆæžœç³»ç»Ÿ
- [AI é…ç½®æ–‡æ¡£](../README.md#ai-configuration) - AI å…¨å±€é…ç½®è¯´æ˜Ž

---

**æ›´æ–°æ—¶é—´**: 2026-01-06
**ç‰ˆæœ¬**: v1.0
**æ›´æ–°å†…å®¹**: ä¸ºæ‰€æœ‰ NPC å’Œå‰å°å®¢æœæ·»åŠ æ˜¼å¤œæ„ŸçŸ¥ä¸Žè¡Œä¸šåˆ†äº«åŠŸèƒ½
