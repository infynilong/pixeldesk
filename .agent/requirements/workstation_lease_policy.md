# 需求文档：工位资源活跃度驱动管理方案

## 1. 背景与目标
为了解决工位资源（共4000个）被非活跃用户长期占用（“僵尸号”占用）的问题，提高系统的日活跃用户数（DAU），将原有的固定30天租期改为基于用户活跃度的“动态合约记录”模式。

## 2. 核心规则
### 2.1 租赁合同
- **默认租期**：30天（初始签约时长）。
- **续约机制**：用户每次登录系统，租期自动重置为自当前时间起算的 **7天**（即：只要用户保持活跃，工位永久有效；若不活跃，资源将进入衰减回收状态）。

### 2.2 活跃度监控（阶梯式提醒）
- **3天未上线**：系统记录状态。NPC 在对话中增加温馨提示（“好久没看到你在工位忙碌了”）。
- **5天未上线**：触发**邮件温馨告警**。提醒用户合同即将因长期不在场而失效。支持中英文多语言。
- **7天未上线**：**执行合同解约（Reclamation）**。系统自动回收工位，释放资源。

### 2.3 积分清退政策
- 若工位因 7 天未上线被提前收回，系统将根据原合同剩余天数计算并返还积分。
- **返还公式**：`Math.floor(初始费用 * (剩余有效天数 / 30))`。
- **记录**：返还记录将记入积分历史，类型标记为 `REFUND`。

## 3. UI/UX 设计变更
### 3.1 签约弹窗（Contract UI）
- **样式**：采用像素风卷轴或复古公文纸张设计，模拟“入驻协议”的正式感。
- **文案**：
    - 标题：由“工位绑定”改为“工位入驻协议”或“像素工坊办公位租赁合同”。
    - 按钮：由“确认绑定”改为“签约入驻”。
    - 条款详情：在弹窗中明确告知“3/5/7”活跃度规则。

## 4. 技术实现
- **定时任务**：每小时执行一次扫描，处理过期的绑定、发送预警邮件及执行回收逻辑。
- **邮件模块**：集成 `RESEND` 接口，并根据用户语言偏好发送中/英邮件。
- **数据库**：在 `user_workstations` 表增加 `lastInactivityWarningAt` 字段，防止重复发送同一阶段的警告。
